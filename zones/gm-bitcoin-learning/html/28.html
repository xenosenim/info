<!doctype html>
<html lang="en">
<head>
  <meta http-equiv='Content-Type' content='text/html; charset=UTF-8'>
  <meta name='viewport' content='width=device-width, initial-scale=1.0, user-scalable=1.0'>
  <title>Bitcoin Learning</title>
  <link rel='stylesheet' type='text/css' media='screen' href='/styles/commons.css'>
  <link rel="stylesheet" type="text/css" href="../styles/tipped.css">
  <link rel="stylesheet" type="text/css" href="../styles/jquery-ui.min.css">
  <link rel="stylesheet" type="text/css" href="../styles/tachyons.min.css">
  <link rel="stylesheet" type="text/css" href="../styles/style.css">
  <script type='text/javascript' src='/scripts/commons.js'></script>
</head>
<body>
<div id='idPanel'>
<div id='idTopbar'>
  <div id='idTopbarNavigation'>
    <a href='/'><span class='clNavHome'><span></a>
    <a href='../../index.html'><span class='clNavIndex'><span></a>
    <a href='./27.html'><span class='clNavLeft'><span></a>
    <a href='../index.html'><span class='clNavUp'><span></a>
    <a href='./29.html'><span class='clNavRight'><span></a>
  </div>
</div>

<div id='idContent'>

<h1>28.51% Attack</h1>
<p class="subheading">Rewriting the blockchain.</p>

<p><a target='_blank' href='../images/28.51-attack.png'><img class='clImageThumb' src='../images/28.51-attack.png'></a><br><br></p>
<p>A 51% Attack refers to the act of intentionally building a new longest chain of blocks to replace blocks in the blockchain. This allows you to <strong>replace transactions</strong> that have been mined in to the blockchain.</p>
<p>This kind of attack is easiest to perform when you have a <strong>majority of the mining power</strong>, which is why it’s referred to as a “Majority Attack” or a “51% Attack”.</p>
<h2>How does a 51% Attack work?</h2>
<p>Nodes always accept the longest known chain of blocks as the <em>valid</em> version of the blockchain. So if you want to “undo” a transaction from the blockchain, you just need to build a new chain of blocks <em>without</em> that transaction in it.</p>

<a target='_blank' href='../images/28.example-build-longest-chain.png'><img class='clImageThumb' src='../images/28.example-build-longest-chain.png'></a><br><br>
<p class='clFigcaption'>Let’s say we paid for a car in bitcoin and drove off with it.</p>


<p>When nodes receive this new longer chain of blocks, they will perform a chain reorganisation to deactivate blocks in their old longest chain, and activate the blocks in the new longest chain you have given them.</p>

<a target='_blank' href='../images/28.example-chain-reorganisation.png'><img class='clImageThumb' src='../images/28.example-chain-reorganisation.png'></a><br><br>
<p class='clFigcaption'>Transactions in the old chain are now invalid. Our payment for the car never happened.</p>


<p>So by building a new longest chain to replace an existing one, you are effectively rewriting the blockchain and creating a new history of transactions for every node on the network to accept. As a result, you have reversed transactions that we previously thought to have been a permanent part of the blockchain.</p>
<p>However, actually performing a successful 51% Attack is not quite this simple…</p>
<p class="note text">
<strong>Note:</strong> You would want to include a <em>replacement</em> transaction in the new chain to send the bitcoins to a <em>new</em> destination (e.g. to your address and not to the car dealer’s). Otherwise the original transaction could get mined in to the main chain again.
</p>
<h2>What prevents a 51% attack?</h2>
<p>Every miner is incentivised to build upon the current longest chain of blocks. So if the combined mining power of every other miner on the network is greater than yours, it makes it incredibly difficult to be able to outwork the other miners to build a longer chain and replace the existing one.</p>

<a target='_blank' href='../images/28.prevent-combined-mining.png'><img class='clImageThumb' src='../images/28.prevent-combined-mining.png'></a><br><br>
<p class='clFigcaption'>Miners working together can build a chain faster than you can on your own.</p>


<p>But of course, if you can actually acquire <em>more</em> mining power than all other miners combined, then you have the ability to outrun the current longest chain and build a new longer chain for everyone else to adopt.</p>

<a target='_blank' href='../images/28.prevent-majority-power.png'><img class='clImageThumb' src='../images/28.prevent-majority-power.png'></a><br><br>
<p class='clFigcaption'>It’s just a matter of time before you build a longer chain if you have the majority of mining power.</p>


<p>So to prevent this from happening we need to ensure that no single miner has the ability to acquire a majority of the mining power. This is achieved by allowing anyone in the world to mine, and incentivising these miners to do so by offering block rewards.</p>

<a target='_blank' href='../images/28.prevent-incentive.png'><img class='clImageThumb' src='../images/28.prevent-incentive.png'></a><br><br>
<p class='clFigcaption'>Miners are incentivised to work on the longest known chain.</p>


<p>As a result, miners focus their energy on building the same chain, making it difficult for any individual to be able to rewrite what has already been written to the blockchain.</p>
<blockquote>
<p>As long as a majority of CPU power is controlled by nodes that are not cooperating to attack the network, they’ll generate the longest chain and outpace attackers. – Satoshi Nakamoto</p>
</blockquote>
<h2>How difficult is it to perform a 51% attack?</h2>
<p>The tricky part would be getting all the hardware needed to be able to perform the attack in the first place. That would be incredibly expensive and difficult. However, if you <em>did</em> manage to acquire a majority of the mining power, then it’s <strong>only a matter of time</strong> before you build a new longest chain.</p>
<p>Having said that, it does take more work to replace a large number of blocks than it would to replace just a few. So the further down a transaction makes it in to the blockchain, the more time and energy it’s going to take to reverse it.</p>

<a target='_blank' href='../images/28.depth-work.png'><img class='clImageThumb' src='../images/28.depth-work.png'></a><br><br>
<p class='clFigcaption'>Transactions get harder to replace the further they get in to the blockchain.</p>


<p>But again, this is assuming you can get the hardware to attain 51% or more of the mining power to outpace all the other miners. Good luck with that.</p>
<p>Nonetheless, you can still try and perform this kind of attack with less than 50% mining power, but the odds are very much against you…</p>
<h2>Can you rewrite the blockchain with less than 50% mining power?</h2>
<p>Yes, but you’ll need to have luck on your side.</p>
<p>Mining is unpredictable, so even if you’ve got a small amount of mining power, there’s nothing to say that you wouldn’t be able to get lucky and mine the next 2 blocks in a row. It’s highly unlikely, but not impossible. The probability depends on how much mining power you have relative to everyone else.</p>
<p><a target='_blank' href='../images/28.rewrite-luck.png'><img class='clImageThumb' src='../images/28.rewrite-luck.png'></a><br><br></p>
<p>Of course, the further down a transaction is in the blockchain, the luckier you’ll need to get to be able to mine X blocks in a row. If nobody has a majority of the mining power, it gets <em>exponentially more difficult</em> to replace a transaction the further it gets in to the blockchain.</p>

<a target='_blank' href='../images/28.mining-power-success-chart.png'><img class='clImageThumb' src='../images/28.mining-power-success-chart.png'></a><br><br>
<p class='clFigcaption'>e.g. If a miner has 40% of the mining power, they have roughly a 50% chance of being able to replace a transaction 5 blocks deep in the chain.</p>


<p>So unless you’ve got a significant proportion of the total mining power on the bitcoin network, your chances of replacing a mined transaction are slim, and those chances diminish quickly as the transaction makes it further down the chain.</p>
<p>Here’s a table of your exact odds:</p>
<table>
<caption>
Probabilities of replacing top X blocks in the blockchain based on how much mining power you have.
</caption>
<tr>
<th></th>
<th>50% Control</th>
<th>40% Control</th>
<th>30% Control</th>
<th>20% Control</th>
<th>10% Control</th>
</tr>
<tr class="tooltip-left" data-tooltip="Replacing top block.">
<td style="background-color:#ccc;">
1</td>
<td>100%</td>
<td>73.6%</td>
<td>44.6%</td>
<td>20.4%</td>
<td>5.1%</td>
</tr>
<tr class="tooltip-left" data-tooltip="Replacing top 2 blocks.">
<td style="background-color:#ccc;">
2</td>
<td>100%</td>
<td>66.4%</td>
<td>32.5%</td>
<td>10.3%</td>
<td>1.3%</td>
</tr>
<tr class="tooltip-left" data-tooltip="Replacing top 3 blocks.">
<td style="background-color:#ccc;">
3</td>
<td>100%</td>
<td>60.3%</td>
<td>23.9%</td>
<td>5.3%</td>
<td>0.4%</td>
</tr>
<tr class="tooltip-left" data-tooltip="Replacing top 4 blocks.">
<td style="background-color:#ccc;">
4</td>
<td>100%</td>
<td>55.0%</td>
<td>17.7%</td>
<td>2.7%</td>
<td>0.1%</td>
</tr>
<tr class="tooltip-left" data-tooltip="Replacing top 5 blocks.">
<td style="background-color:#ccc;">
5</td>
<td>100%</td>
<td>50.4%</td>
<td>13.2%</td>
<td>1.4%</td>
<td>0.02%</td>
</tr>
<tr class="tooltip-left" data-tooltip="Replacing top 6 blocks.">
<td style="background-color:#ccc;">
6</td>
<td>100%</td>
<td>46.2%</td>
<td>9.9%</td>
<td>0.7%</td>
<td>0.006%</td>
</tr>
<tr class="tooltip-left" data-tooltip="Replacing top 7 blocks.">
<td style="background-color:#ccc;">
7</td>
<td>100%</td>
<td>42.5%</td>
<td>7.4%</td>
<td>0.4%</td>
<td>0.001%</td>
</tr>
<tr class="tooltip-left" data-tooltip="Replacing top 8 blocks.">
<td style="background-color:#ccc;">
8</td>
<td>100%</td>
<td>39.1%</td>
<td>5.6%</td>
<td>0.2%</td>
<td>0.0004%</td>
</tr>
<tr class="tooltip-left" data-tooltip="Replacing top 9 blocks.">
<td style="background-color:#ccc;">
9</td>
<td>100%</td>
<td>36.0%</td>
<td>4.2%</td>
<td>0.1%</td>
<td>0.0001%</td>
</tr>
<tr class="tooltip-left" data-tooltip="Replacing top 10 blocks.">
<td style="background-color:#ccc;">
10</td>
<td>100%</td>
<td>33.2%</td>
<td>3.1%</td>
<td>0.06%</td>
<td>0.00003%</td>
</tr>
</table>
<p class="note tip">
<strong>Tip:</strong> The numbers in the table above assume you are attempting to replace blocks by building an alternate chain that is <em>one block longer</em> than the current longest chain.
</p>

<h3>Equation</h3>


<p>The probability of being to able to intentionally rewrite blocks in the blockchain is just a function of how much mining power you have and how many blocks you want to try and replace.</p>

<a target='_blank' href='../images/28.equation-success.png'><img class='clImageThumb' src='../images/28.equation-success.png'></a><br><br>
<p class='clFigcaption'>The proof that blocks get harder to replace the further down they are in the chain is an important part of the system’s integrity and security. This equation is from the Bitcoin Whitepaper (Section 11).</p>


<p>Anyway, here’s what that equation looks like in Ruby code:</p>
<div class="sourceCode"><pre class="sourceCode ruby"><code class="sourceCode ruby"><span><span class="co"># p = probability honest node finds the next block</span></span>
<span><span class="co"># q = probability attacker finds the next block</span></span>
<span><span class="co"># z = number of blocks to catch up</span></span>
<span></span>
<span><span class="kw">def</span> attacker_success_probability(q, z)</span>
<span>  p = <span class="dv">1</span> - q</span>
<span>  lambda = z * (q / p) <span class="co"># expected number of occurrences in the poisson distribution</span></span>
<span>  sum = <span class="fl">1.0</span></span>
<span></span>
<span>  <span class="kw">for</span> k <span class="kw">in</span> <span class="dv">0</span>..z</span>
<span>    poisson = <span class="dt">Math</span>.exp(-lambda) <span class="co"># exp() raises e (natural logarithm) to a number</span></span>
<span>    <span class="kw">for</span> i <span class="kw">in</span> <span class="dv">1</span>..k</span>
<span>      poisson *= lambda / i</span>
<span>    <span class="kw">end</span></span>
<span></span>
<span>    sum -= poisson * (<span class="dv">1</span> - (q/p)**(z-k) )</span>
<span>  <span class="kw">end</span></span>
<span></span>
<span>  <span class="kw">return</span> sum</span>
<span><span class="kw">end</span></span>
<span></span>
<span><span class="co"># Example</span></span>
<span>puts attacker_success_probability(<span class="fl">0.4</span>, <span class="dv">5</span>) <span class="co">#=&gt; 0.5506251290702077</span></span></code></pre>

<p class="note tip">
<strong>Tip:</strong> The equation above works out the probability of <em>catching up</em> with the longest chain (from being a specified number of blocks behind). If you want to <em>replace</em> blocks in the chain, you need to go <em>one block longer</em>.
</p>
</div>
<h3>Another Chart</h3>



<a target='_blank' href='../images/28.success_chart_50_blocks.png'><img class='clImageThumb' src='../images/28.success_chart_50_blocks.png'></a><br><br>
<p class='clFigcaption'>You can see the exponential decay in probability of being able to replace a transaction the deeper it makes it in to the blockchain.</p>




<h2>FAQ</h2>
<h3>Has anyone successfully performed a 51% Attack on Bitcoin?</h3>
<p>Nope, not yet.</p>
<p>Some miners have come close to reaching 50% or more of the total mining power over Bitcoin’s history, but nobody has actually performed a successful 51% Attack.</p>

<a target='_blank' href='../images/28.mining-distribution-ghash-2014.jpg'><img class='clImageThumb' src='../images/28.mining-distribution-ghash-2014.jpg'></a><br><br>
<p class='clFigcaption'>GHash.io came close to reaching 50% in 2014.<br></p>

<p class="note text">
<strong>Note:</strong> Even if a miner gets over 50% mining power, it doesn’t necessarily mean that they’re actually going to perform an attack (it just means that they <em>can</em>). If anything, if you’ve got that much power it’s probably more lucrative to keep mining blocks and collecting block rewards than it would be to reverse a single transaction (and sink the value of bitcoin because of your attack).
</p>
<h2>How much hashpower do I need to perform a 51% Attack?</h2>
<p>You can use the current target value to estimate how much hash power you would need to get majority control.</p>
<p class="note tip">
<strong>Tip:</strong> The target moves up and down based on how much quickly all miners on the network are able to mine new blocks. We can therefore use it to figure out how fast we need to be able to hash to outpace the current speed of the network.
</p>
<p>First of all, we can get the current target by looking at the “bits” field inside the block header of the most recently mined block.</p>
<p>Fatal error: Uncaught TypeError: Unsupported operand types: string / int in /home/admini/learnmeabitcoin/website/technical/51-attack.md:250 Stack trace: #0 {main} thrown in /home/admini/learnmeabitcoin/website/technical/51-attack.md on line 250</p>

</div>
</div>
</body>
</html>
